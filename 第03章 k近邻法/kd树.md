## **kd树**

**kd树**是一种用于高效存储和检索k维空间中的点的数据结构

 

- **根节点**：首先，选择一个坐标轴（比如x轴），并找到所有点在x轴上的中位数。这个中位数点就是根节点。
- **划分空间**：通过这个中位数点，画一条垂直于x轴的线，将空间分成两部分：左边的点x坐标小于中位数，右边的点x坐标大于中位数。
- **递归划分**：对左右两部分重复上述过程，但这次**选择另一个坐标轴（比如y轴）**。这样交替选择坐标轴，直到每个区域只有一个点或没有点为止。

### 构造平衡kd树算法

#### 	1.构造根节点

在一个包含N个k维数据点的数据集T中选择一个坐标轴（比如第一个坐标轴x(1)*x*(1)）, 找到所有数据点在x(1)*x*(1)坐标上的中位数（即排序后位于中间的那个点）。用这个中位数作为切分点，将数据集T分成两部分：左子区域：所有x(1)*x*(1)坐标小于中位数的点。右子区域：所有x(1)*x*(1)坐标大于中位数的点。将中位数对应的点保存在根节点, 



#### 2.递归构造子树

对每个子区域，重复上述过程，但这次选择下一个坐标轴（比如x(2)*x*(2)）。找到当前子区域中所有数据点在x(2)*x*(2)坐标上的中位数，并用它作为切分点。将子区域进一步划分为更小的左子区域和右子区域。将中位数对应的点保存在当前节点。当前节点的左子节点对应左子区域，右子节点对应右子区域。继续递归，直到某个子区域中没有数据点为止。当某个子区域中没有数据点时，停止递归。此时，树的结构已经形成。



## KD树的最临近搜索算法

   现实生活中有许多问题需要在多维数据的快速分析和快速搜索，对于这个问题最常用的方法是所谓的 kd 树。在 k-d 树中进行数据的查找也是特征匹配的重要环节，其目的是检索**在k-d树中与查询点距离最近的数据点**。

  通过二叉搜索，顺着搜索路径很快就能找到最邻近的近似点，也就是叶子节点（2,3）。而找到的叶子节点并不一定就是最邻近的，最邻近肯定距离查询点更近，应该位于以查询点为圆心且通过叶子节点的圆域内。为了找到真正的最近邻，还需要进行相关的‘回溯'操作。也就是说，算法首先沿搜索路径反向查找是否有距离查询点更近的数据点。


![image-20250212101255046](C:\Users\AmTo2\AppData\Roaming\Typora\typora-user-images\image-20250212101255046.png)

二叉树搜索：先从（7,2）点开始进行二叉查找，然后到达（5,4），最后到达（2,3），此时搜索路径中的节点为<(7,2)，(5,4)，(2,3)>，首先以（2,3）作为当前最近邻点，计算其到查询点（2.1,3.1）的距离为0.1414，
回溯查找：在得到（2,3）为查询点的最近点之后，回溯到其父节点（5,4），并判断在该父节点的其他子节点空间中是否有距离查询点更近的数据点。以（2.1,3.1）为圆心，以0.1414为半径画圆，如下图所示。发现该圆并不和超平面y = 4交割，因此不用进入（5,4）节点右子空间中(图中灰色区域)去搜索；
最后，再回溯到（7,2），以（2.1,3.1）为圆心，以0.1414为半径的圆更不会与x = 7超平面交割，因此不用进入（7,2）右子空间进行查找。至此，搜索路径中的节点已经全部回溯完，结束整个搜索，返回最近邻点（2,3），最近距离为0.1414。


